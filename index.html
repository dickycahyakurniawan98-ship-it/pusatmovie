<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DICAKUN - Streaming Film</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #0d1117; color: #e6e6e6; }
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="sticky top-0 z-50 bg-gray-900 shadow-xl">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center h-16">
    <a href="#" onclick="navigateTo('home')" class="text-2xl font-extrabold text-red-500 tracking-wider">DICAKUN</a>
    <div class="hidden md:flex space-x-4">
      <button onclick="filterContent('Movie')" class="text-gray-300 hover:text-white">Movie</button>
      <button onclick="filterContent('Series')" class="text-gray-300 hover:text-white">Serial</button>
      <button onclick="filterContent('Donghua')" class="text-gray-300 hover:text-white">Donghua</button>
      <button onclick="filterContent('Anime')" class="text-gray-300 hover:text-white">Anime</button>
    </div>
    <input type="text" id="search-input" placeholder="Cari..." class="bg-gray-800 text-white rounded px-3 py-1 focus:ring focus:ring-red-500" />
    <button onclick="performSearch()" class="text-gray-400 hover:text-white">üîç</button>
  </div>
</nav>

<!-- Konten -->
<main id="app-content" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <p class="text-center text-gray-400">Memuat daftar film...</p>
</main>

<!-- Modal -->
<div id="message-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 z-[100] flex items-center justify-center">
  <div class="bg-gray-800 p-6 rounded-lg shadow-2xl max-w-sm w-full">
    <h3 class="text-xl font-bold mb-3 text-red-500">Pesan</h3>
    <p id="message-text" class="text-gray-300 mb-4"></p>
    <button onclick="closeModal()" class="w-full bg-red-600 text-white py-2 rounded-md hover:bg-red-700 transition">Tutup</button>
  </div>
</div>

<script>
// ========== 1. LOAD DATA ==========
let dummyData = [];

async function loadMovieData() {
  try {
    const res = await fetch("movie.html");
    const text = await res.text();

    // Ambil isi JSON dari tag <script id="movie-data">
    const match = text.match(/<script id="movie-data" type="application\/json">([\s\S]*?)<\/script>/);
    if (match) {
      dummyData = JSON.parse(match[1]);
      console.log("Data film berhasil dimuat:", dummyData.length, "film");
      renderApp();
    } else {
      document.getElementById('app-content').innerHTML = "<p class='text-center text-red-500'>Gagal memuat data.</p>";
    }
  } catch (err) {
    console.error("Gagal load movie.html", err);
  }
}

// ========== 2. SEMUA FUNGSI ASLI ==========
function showModal(msg) {
  document.getElementById('message-text').textContent = msg;
  document.getElementById('message-modal').classList.remove('hidden');
}
function closeModal() { document.getElementById('message-modal').classList.add('hidden'); }

function getMovieById(id) {
  return dummyData.find(m => m.id === parseInt(id));
}

function renderApp() {
  const params = new URLSearchParams(location.hash.replace("#", ""));
  const view = params.get("view") || "home";
  const id = params.get("id");
  if (view === "player" && id) renderPlayer(getMovieById(id));
  else renderHome();
}

function navigateTo(view, id=null) {
  location.hash = id ? `view=${view}&id=${id}` : `view=${view}`;
  renderApp();
}

function renderPostCard(movie) {
  return `
    <div class="rounded-lg overflow-hidden cursor-pointer" onclick="navigateTo('player', ${movie.id})">
      <div class="relative">
        <img src="${movie.imageUrl}" alt="${movie.title}" class="w-full h-72 object-cover">
        <div class="absolute top-2 right-2 bg-yellow-500 text-black text-xs px-2 py-0.5 rounded">‚≠ê${movie.rating}</div>
      </div>
      <h3 class="text-white font-semibold mt-2 truncate">${movie.title}</h3>
      <p class="text-gray-400 text-sm">${movie.type}</p>
    </div>
  `;
}

function renderHome() {
  const container = document.getElementById("app-content");
  container.innerHTML = `
    <h2 class="text-3xl font-bold text-white mb-6 border-b border-red-600 pb-2">Daftar Film</h2>
    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
      ${dummyData.map(renderPostCard).join('')}
    </div>
  `;
}

function renderPlayer(movie) {
  if (!movie) return showModal("Film tidak ditemukan.");
  const embed = movie.embed.googleDrive 
    ? `https://drive.google.com/file/d/${movie.embed.googleDrive}/preview`
    : movie.embed.dailymotion
      ? `https://www.dailymotion.com/embed/video/${movie.embed.dailymotion}`
      : "";
  document.getElementById("app-content").innerHTML = `
    <h1 class="text-2xl font-bold mb-4"><button onclick="navigateTo('home')" class="text-gray-400 hover:text-red-500 mr-2">&larr;</button>${movie.title}</h1>
    <div class="aspect-video bg-black mb-4"><iframe src="${embed}" allowfullscreen class="w-full h-full"></iframe></div>
    <p class="text-gray-400">Rating: ‚≠ê${movie.rating}</p>
  `;
}

function filterContent(type) {
  const filtered = dummyData.filter(m => m.type === type);
  if (filtered.length === 0) return showModal(`Tidak ada konten untuk ${type}.`);
  document.getElementById("app-content").innerHTML = `
    <h2 class="text-2xl font-bold text-white mb-6">${type}</h2>
    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
      ${filtered.map(renderPostCard).join('')}
    </div>
  `;
}

function performSearch() {
  const q = document.getElementById("search-input").value.toLowerCase();
  if (!q) return showModal("Masukkan kata kunci pencarian.");
  const result = dummyData.filter(m => m.title.toLowerCase().includes(q));
  if (result.length === 0) showModal(`Tidak ada hasil untuk "${q}"`);
  else document.getElementById("app-content").innerHTML = `
    <h2 class="text-2xl font-bold mb-6">Hasil untuk: ${q}</h2>
    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
      ${result.map(renderPostCard).join('')}
    </div>
  `;
}

window.addEventListener("hashchange", renderApp);
loadMovieData();
</script>

</body>
</html>
