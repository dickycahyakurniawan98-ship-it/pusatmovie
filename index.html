<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DICAKUN - Situs Film, Series, Donghua, Anime </title>
    <!-- Memuat Tailwind CSS untuk styling responsif -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Menggunakan font Inter secara default */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
        }
        /* Custom scrollbar style for better UX on the category bar */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        /* Penyesuaian untuk iframe di dalam div relative */
        .iframe-container {
             position: relative;
             width: 100%;
             height: 0;
             /* PERBAIKAN 1: Menambah tinggi frame video (rasio 16:9) */
             /* Dari 56.25% menjadi 65% untuk tampilan lebih besar di mobile */
             padding-bottom: 65%; 
             overflow: hidden;
             border-radius: 0.5rem; /* rounded-lg */
             box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1); /* shadow-xl */
        }
        .iframe-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        /* Style untuk overlay transparan penuh */
        .transparent-overlay {
            /* Warna transparan penuh agar tidak terlihat */
            background-color: transparent; 
            /* Memastikan lapisan menutupi seluruh frame */
            width: 100%;
            height: 100%;
            /* Pastikan kursor berubah menjadi pointer */
            cursor: pointer;
            /* Tambahkan sedikit efek hover visual untuk feedback, misal: opacity */
            transition: opacity 0.1s ease;
        }
        .transparent-overlay:hover {
            /* Sedikit kegelapan saat di hover, sebagai feedback visual */
            background-color: rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body class="min-h-screen">

    <!-- Header & Navigasi Utama -->
    <header class="bg-blue-800 shadow-lg"> 
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
            <!-- Logo/Judul: DICAKUN -->
            <h1 class="text-3xl font-extrabold text-white tracking-wider">
                <a href="#home" onclick="navigate('home')" class="hover:text-blue-200 transition duration-300">DICAKUN</a>
            </h1>

            <!-- Search Bar dan Tombol Navigasi -->
            <div class="w-full md:w-auto flex flex-col md:flex-row items-center space-y-3 md:space-y-0 md:space-x-4">
                
                <!-- Search Input Group -->
                <div class="flex w-full md:w-64">
                    <input 
                        type="text" 
                        id="search-input"
                        placeholder="Cari film atau series..." 
                        class="p-2 w-full rounded-l-lg focus:ring-blue-400 focus:border-blue-400 border-none text-gray-800 shadow-inner"
                        onkeydown="if(event.key === 'Enter') searchMovies()"
                    >
                    <button 
                        onclick="searchMovies()" 
                        class="bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-r-lg transition duration-300 shadow-md flex items-center justify-center"
                        aria-label="Tombol Pencarian"
                    >
                        <!-- Icon Kaca Pembesar (Inline SVG for simplicity) -->
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    </button>
                </div>
                
                <!-- Tombol Beranda -->
                <button onclick="navigate('home')" class="px-4 py-2 w-full md:w-auto text-white font-semibold rounded-lg bg-blue-600 hover:bg-blue-700 transition duration-300 shadow-md">
                    Beranda
                </button>
            </div>
        </div>

        <!-- BILAH KATEGORI BARU (Di bawah header, responsif) -->
        <div class="bg-blue-700 w-full shadow-inner">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div id="category-bar" class="flex overflow-x-auto whitespace-nowrap py-2 space-x-3 no-scrollbar">
                    <!-- Tombol Home/Semua -->
                    <button 
                        onclick="filterType('All')" 
                        class="category-btn px-4 py-1.5 text-sm font-medium rounded-full transition duration-200 shadow-md flex-shrink-0 bg-blue-500 text-white hover:bg-blue-400"
                        data-type="All"
                    >
                        Semua Konten
                    </button>
                    <!-- Tombol Movie -->
                    <button 
                        onclick="filterType('Movie')" 
                        class="category-btn px-4 py-1.5 text-sm font-medium rounded-full transition duration-200 shadow-md flex-shrink-0 bg-blue-900 text-white hover:bg-blue-600"
                        data-type="Movie"
                    >
                        Movie
                    </button>
                    <!-- Tombol Series -->
                    <button 
                        onclick="filterType('Series')" 
                        class="category-btn px-4 py-1.5 text-sm font-medium rounded-full transition duration-200 shadow-md flex-shrink-0 bg-blue-900 text-white hover:bg-blue-600"
                        data-type="Series"
                    >
                        Series TV
                    </button>
                    <!-- Tombol Donghua (Ditambahkan) -->
                    <button 
                        onclick="filterType('Donghua')" 
                        class="category-btn px-4 py-1.5 text-sm font-medium rounded-full transition duration-200 shadow-md flex-shrink-0 bg-blue-900 text-white hover:bg-blue-600"
                        data-type="Donghua"
                    >
                        Donghua
                    </button>
                    <!-- Tombol Anime (Ditambahkan) -->
                    <button 
                        onclick="filterType('Anime')" 
                        class="category-btn px-4 py-1.5 text-sm font-medium rounded-full transition duration-200 shadow-md flex-shrink-0 bg-blue-900 text-white hover:bg-blue-600"
                        data-type="Anime"
                    >
                        Anime
                    </button>
                    <!-- Tombol akan bergeser (scrollable) di mobile -->
                </div>
            </div>
        </div>
        <!-- AKHIR BILAH KATEGORI -->

    </header>

    <!-- Konten Utama -->
    <main id="main-content" class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
        <!-- Konten akan dimuat di sini oleh JavaScript -->
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white mt-12 py-6">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p>&copy; 2024 DICAKUN. Semua Hak Cipta Dilindungi.</p>
        </div>
    </footer>

    <!-- Logika JavaScript -->
    <script>
        // PERBAIKAN 2: Tambahkan parameter controls=1 untuk memastikan kontrol YouTube muncul di frame.
        const placeholderEmbed = "https://www.youtube.com/embed/dQw4w9WgXcQ?autoplay=0&controls=1";

        // --- FUNGSI UTILITY BARU: SLUGIFY ---
        function slugify(text) {
            return text.toString().toLowerCase()
                .replace(/\s+/g, '-')           // Ganti spasi dengan tanda hubung
                .replace(/[^\w\-]+/g, '')       // Hapus semua karakter non-kata
                .replace(/\-\-+/g, '-')         // Ganti tanda hubung ganda dengan satu
                .replace(/^-+/, '')             // Hapus tanda hubung dari awal
                .replace(/-+$/, '');            // Hapus tanda hubung dari akhir
        }
        // --- AKHIR FUNGSI UTILITY BARU: SLUGIFY ---


        const mockMovies = [
            { 
                id: 1, 
                title: "kuntilanak 3 (2022)", 
                category: "Adventure/Horror", 
                rating: "4.2", 
                type: "Movie", 
                views: 9800, 
                posterUrl: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhmGbaoxhd8L40fhU59nXbBbSwnoRQhQF5QY1DvTNNH0V1ozVyhdgaKSzinobeRkCcj4CZuK8ireNwLkHDm-vYI5mIDfqOYhytPG0cHqTdpTTWY8d8UAh5up-eTq97Hc5CLpcv9N-ym4QPIg-Y_QsHOPJJZ4sdJaaV_2_p9C91i19cimpARv4sfh1AtG9c/s275/Kuntilanak3_film2022_Poster_official.jpeg",
                synopsis: "Dinda, who is considered strange by the village children because of her strength, accidentally injures Panji and Ambar. She regrets and asks Aunt Donna to register her at the Mata Hati School, so that she can learn to control her power.",
                monetizationLink: "https://perky-ad.com/vmbeGK", // INI UNTUK OVERLAY (IKLAN)
                embedCode: "https://www.dailymotion.com/embed/video/x8o9jtq?autoplay=1",
            },
            { 
                id: 2, 
                title: "Squid Game Final season", 
                category: "Drama/Action", 
                rating: "8.0", 
                type: "Series", 
                views: 4500, 
                posterUrl: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgHhmgXcuINBgJQo3RqGmxIhFglGR-tyhufC4Jc1F00D1H4g6TBgAn9Ni4-SbEGhtglJSPc7YiSuahin6WrxcY4h23RjDjgaAz0jkVqJK6Se4j55_L1osLP9bsryeDL09AJvawKVYrUNeJwSFwPMJOjBp3GmxtNIlgWgYnO7OuwuUAxalji4ohmiinFh0dw/s1481/squidgame%20season3.jpg",
            
                monetizationLink: "https://perky-ad.com/vmbeGK", // INI UNTUK OVERLAY (IKLAN)
            
                defaultEmbedUrl: "https://drive.google.com/file/d/1bO2uv_WW4XTPRJ-vhXk6AE2vyr2smrYS/preview", // KONTROL DITAMBAHKAN
                totalEpisodes: 6, 
                episodes: [
                    { num: 1, embedUrl: "https://drive.google.com/file/d/1bO2uv_WW4XTPRJ-vhXk6AE2vyr2smrYS/preview" }, 
                    { num: 2, embedUrl: "https://drive.google.com/file/d/1a3QpRzn2RqRUmlzk96pYrst9yOBErvYS/preview" }, 
                    { num: 3, embedUrl: "https://drive.google.com/file/d/1f2gmc4QampOQxIhUdMdaJ7iDwS9jOkI8/preview" }, 
                    { num: 4, embedUrl: "https://drive.google.com/file/d/1IhjZPDwVmSzf2p4MG7f2e89rx7JyWnD1/preview" },
                    { num: 5, embedUrl: "https://drive.google.com/file/d/1rY81t8FcUtSkc-SneD2Ai3d7KR356H9n/preview" },
                    { num: 6, embedUrl: "https://drive.google.com/file/d/1X3tCFGVxxxtYPLy40NMVYnJXnMHUA0eV/preview" }
                   
                ]
            },
            { 
                id: 3, 
                title: "Film Komedi Terbaik", 
                category: "Komedi", 
                rating: "9.1", 
                type: "Movie", 
                views: 12100, 
                posterUrl: "https://placehold.co/300x450/ff9800/ffffff?text=MOVIE+3",
                synopsis: "Sebuah komedi situasi yang absurd tentang dua sahabat yang mencoba menjadi kaya dalam semalam melalui skema yang paling konyol. Dijamin mengocok perut dengan humor yang tidak terduga.",
                monetizationLink: "https://adsterra.com/direct-link-3", // INI UNTUK OVERLAY (IKLAN)
                downloadLink: "https://drive.google.com/unduhan/film3", // INI UNTUK TOMBOL UNDUH (FILM ASLI)
                embedCode: "https://www.youtube.com/embed/ganti-dengan-kode-video-anda?autoplay=0&controls=1", // KONTROL DITAMBAHKAN
            },
            { 
                id: 4, 
                title: "Horor Malam Jumat", 
                category: "Horor/Thriller", 
                rating: "6.5", 
                type: "Series", 
                views: 3200, 
                posterUrl: "https://placehold.co/300x450/673ab7/ffffff?text=SERIES+4",
                synopsis: "Setiap episode menceritakan kisah horor yang berbeda yang terjadi pada malam Jumat. Dari legenda urban hingga kejadian supranatural, series ini akan membuat Anda tidak tidur.",
                monetizationLink: "https://adsterra.com/direct-link-4", // INI UNTUK OVERLAY (IKLAN)
                downloadLink: "https://drive.google.com/unduhan/series4", // INI UNTUK TOMBOL UNDUH (FILM ASLI)
                defaultEmbedUrl: "https://www.youtube.com/embed/ep4_1?autoplay=0&controls=1", 
                totalEpisodes: 3, 
                episodes: [
                    { num: 1, embedUrl: "https://www.youtube.com/embed/ep4_1?autoplay=1&controls=1" }, 
                    { num: 2, embedUrl: "https://www.youtube.com/embed/ep4_2?autoplay=1&controls=1" }, 
                    { num: 3, embedUrl: "https://www.youtube.com/embed/ep4_3?autoplay=1&controls=1" }
                ]
            },
            { 
                id: 5, 
                title: "Dokumenter Alam", 
                category: "Dokumenter", 
                rating: "8.8", 
                type: "Movie", 
                views: 7600, 
                posterUrl: "https://placehold.co/300x450/4caf50/ffffff?text=MOVIE+5",
                synopsis: "Mengungkap keajaiban dan kerapuhan ekosistem bumi, dari kedalaman laut hingga puncak gunung tertinggi. Sebuah karya sinematik yang memukau dan mendidik.",
                monetizationLink: "https://adsterra.com/direct-link-5", // INI UNTUK OVERLAY (IKLAN)
                downloadLink: "https://drive.google.com/unduhan/film5", // INI UNTUK TOMBOL UNDUH (FILM ASLI)
                embedCode: placeholderEmbed,
            },
            { 
                id: 6, 
                title: "Aksi Balas Dendam", 
                category: "Aksi", 
                rating: "8.2", 
                type: "Movie", 
                views: 15000, 
                posterUrl: "https://placehold.co/300x450/f44336/ffffff?text=MOVIE+6", 
                synopsis: "Seorang mantan agen rahasia mencari keadilan setelah keluarganya diserang. Film ini penuh dengan koreografi pertarungan yang intens dan alur cerita yang memeras emosi.", 
                monetizationLink: "https://adsterra.com/direct-link-6", // INI UNTUK OVERLAY (IKLAN)
                downloadLink: "https://drive.google.com/unduhan/film6", // INI UNTUL TOMBOL UNDUH (FILM ASLI)
                embedCode: placeholderEmbed,
            },
            { 
                id: 7, 
                title: "Dunia Fantasi Series", 
                category: "Fantasi", 
                rating: "9.5", 
                type: "Series", 
                views: 25000, 
                posterUrl: "https://placehold.co/300x450/e91e63/ffffff?text=SERIES+7",
                synopsis: "Di dunia yang dipenuhi sihir dan makhluk mitos, sekelompok pahlawan memulai misi berbahaya untuk mengembalikan artefak kuno sebelum jatuh ke tangan raja iblis.",
                monetizationLink: "https://adsterra.com/direct-link-7", // INI UNTUK OVERLAY (IKLAN)
                downloadLink: "https://drive.google.com/unduhan/series7", // INI UNTUK TOMBOL UNDUH (FILM ASLI)
                defaultEmbedUrl: "https://www.youtube.com/embed/ep7_1_panggilan?autoplay=0&controls=1", 
                totalEpisodes: 8, // Diperpanjang hingga 8 episode
                episodes: [
                    { num: 1, embedUrl: "https://www.youtube.com/embed/ep7_1_panggilan?autoplay=1&controls=1" }, 
                    { num: 2, embedUrl: "https://www.youtube.com/embed/ep7_2_hutan?autoplay=1&controls=1" }, 
                    { num: 3, embedUrl: "https://www.youtube.com/embed/ep7_3_perjanjian?autoplay=1&controls=1" },
                    { num: 4, embedUrl: "https://www.youtube.com/embed/ep7_4_gerbang?autoplay=1&controls=1" }, 
                    { num: 5, embedUrl: "https://www.youtube.com/embed/ep7_5_raja?autoplay=1&controls=1" },
                    { num: 6, embedUrl: "https://www.youtube.com/embed/ep7_6_tambahan?autoplay=1&controls=1" }, 
                    { num: 7, embedUrl: "https://www.youtube.com/embed/ep7_7_akhir?autoplay=1&controls=1" },
                    { num: 8, embedUrl: "https://www.youtube.com/embed/ep7_8_final?autoplay=1&controls=1" }
                ]
            },
            { 
                id: 8, 
                title: "Kisah Sedih", 
                category: "Drama", 
                rating: "7.1", 
                type: "Movie", 
                views: 1200, 
                posterUrl: "https://placehold.co/300x450/9c27b0/ffffff?text=MOVIE+8", 
                synopsis: "Sebuah narasi menyentuh tentang kehilangan, penerimaan, dan kekuatan keluarga dalam menghadapi kesulitan yang tak terduga.", 
                monetizationLink: "https://adsterra.com/direct-link-8", // INI UNTUK OVERLAY (IKLAN)
                downloadLink: "https://drive.google.com/unduhan/film8", // INI UNTUK TOMBOL UNDUH (FILM ASLI)
                embedCode: placeholderEmbed,
            },
            { 
                id: 9, 
                title: "Pedang Langit Abadi", 
                category: "Fantasi/Wuxia", 
                rating: "8.9", 
                type: "Donghua", 
                views: 18000, 
                posterUrl: "https://placehold.co/300x450/1a237e/ffffff?text=DONGHUA+9", 
                synopsis: "Kisah kultivasi abadi yang penuh dengan pertempuran magis, persahabatan, dan pengkhianatan di dunia yang luas dan indah.", 
                monetizationLink: "https://adsterra.com/direct-link-9", // INI UNTUK OVERLAY (IKLAN)
                downloadLink: "https://drive.google.com/unduhan/donghua9", // INI UNTUK TOMBOL UNDUH (FILM ASLI)
                defaultEmbedUrl: "https://www.youtube.com/embed/ep9_1?autoplay=0&controls=1", 
                totalEpisodes: 12, 
                episodes: [
                    { num: 1, embedUrl: "https://www.youtube.com/embed/ep9_1?autoplay=1&controls=1" }, 
                    { num: 2, embedUrl: "https://www.youtube.com/embed/ep9_2?autoplay=1&controls=1" },
                    { num: 3, embedUrl: "https://www.youtube.com/embed/ep9_3?autoplay=1&controls=1" },
                    { num: 4, embedUrl: "https://www.youtube.com/embed/ep9_4?autoplay=1&controls=1" },
                    { num: 5, embedUrl: "https://www.youtube.com/embed/ep9_5?autoplay=1&controls=1" },
                    { num: 6, embedUrl: "https://www.youtube.com/embed/ep9_6?autoplay=1&controls=1" },
                    { num: 7, embedUrl: "https://www.youtube.com/embed/ep9_7?autoplay=1&controls=1" },
                    { num: 8, embedUrl: "https://www.youtube.com/embed/ep9_8?autoplay=1&controls=1" },
                    { num: 9, embedUrl: "https://www.youtube.com/embed/ep9_9?autoplay=1&controls=1" },
                    { num: 10, embedUrl: "https://www.youtube.com/embed/ep9_10?autoplay=1&controls=1" },
                    { num: 11, embedUrl: "https://www.youtube.com/embed/ep9_11?autoplay=1&controls=1" },
                    { num: 12, embedUrl: "https://www.youtube.com/embed/ep9_12?autoplay=1&controls=1" }
                ],
            },
            { 
                id: 10, 
                title: "Misteri Pembunuhan", 
                category: "Thriller", 
                rating: "7.8", 
                type: "Movie", 
                views: 6500, 
                posterUrl: "https://placehold.co/300x450/00bcd4/ffffff?text=MOVIE+10", 
                synopsis: "Seorang detektif veteran harus memecahkan serangkaian pembunuhan berantai yang terinspirasi dari karya seni kuno, sebelum korban berikutnya ditemukan.", 
                monetizationLink: "https://adsterra.com/direct-link-10", // INI UNTUK OVERLAY (IKLAN)
                downloadLink: "https://drive.google.com/unduhan/film10", // INI UNTUK TOMBOL UNDUH (FILM ASLI)
                embedCode: placeholderEmbed,
            },
            { 
                id: 11, 
                title: "Anime Petarung", 
                category: "Aksi/Shonen", 
                rating: "9.3", 
                type: "Anime", 
                views: 22000, 
                posterUrl: "https://placehold.co/300x450/d32f2f/ffffff?text=ANIME+11", 
                synopsis: "Seorang anak laki-laki dengan tekad baja berlatih untuk menjadi petarung terkuat di dunia, menghadapi tantangan berat dan musuh yang tak terbayangkan.", 
                monetizationLink: "https://adsterra.com/direct-link-11", // INI UNTUK OVERLAY (IKLAN)
                downloadLink: "https://drive.google.com/unduhan/anime11", // INI UNTUK TOMBOL UNDUH (FILM ASLI)
                defaultEmbedUrl: "https://www.youtube.com/embed/ep11_1?autoplay=0&controls=1", 
                totalEpisodes: 24, 
                episodes: [
                    { num: 1, embedUrl: "https://www.youtube.com/embed/ep11_1?autoplay=1&controls=1" }, 
                    { num: 2, embedUrl: "https://www.youtube.com/embed/ep11_2?autoplay=1&controls=1" }, 
                    { num: 3, embedUrl: "https://www.youtube.com/embed/ep11_3?autoplay=1&controls=1" }, 
                    { num: 4, embedUrl: "https://www.youtube.com/embed/ep11_4?autoplay=1&controls=1" },
                    { num: 5, embedUrl: "https://www.youtube.com/embed/ep11_5?autoplay=1&controls=1" },
                    { num: 6, embedUrl: "https://www.youtube.com/embed/ep11_6?autoplay=1&controls=1" },
                ],
            },
            { 
                id: 12, 
                title: "Komedi Gila", 
                category: "Komedi", 
                rating: "8.3", 
                type: "Series", 
                views: 11000, 
                posterUrl: "https://placehold.co/300x450/cddc39/ffffff?text=SERIES+12", 
                synopsis: "Kehidupan sehari-hari dari sekelompok rekan kerja yang memiliki kepribadian aneh, penuh dengan kesalahpahaman lucu dan momen canggung yang tak terhindarkan.", 
                monetizationLink: "https://adsterra.com/direct-link-12", // INI UNTUK OVERLAY (IKLAN)
                downloadLink: "https://drive.google.com/unduhan/series12", // INI UNTUK TOMBOL UNDUH (FILM ASLI)
                defaultEmbedUrl: "https://www.youtube.com/embed/ep12_1?autoplay=0&controls=1", 
                totalEpisodes: 10, 
                episodes: [
                    { num: 1, embedUrl: "https://www.youtube.com/embed/ep12_1?autoplay=1&controls=1" }, 
                    { num: 2, embedUrl: "https://www.youtube.com/embed/ep12_2?autoplay=1&controls=1" },
                    { num: 3, embedUrl: "https://www.youtube.com/embed/ep12_3?autoplay=1&controls=1" },
                    { num: 4, embedUrl: "https://www.youtube.com/embed/ep12_4?autoplay=1&controls=1" },
                    { num: 5, embedUrl: "https://www.youtube.com/embed/ep12_5?autoplay=1&controls=1" },
                    { num: 6, embedUrl: "https://www.youtube.com/embed/ep12_6?autoplay=1&controls=1" }
                ],
            },
            { 
                id: 13, 
                title: "Donghua Dunia Kultivasi", 
                category: "Fantasi/Wuxia", 
                rating: "8.1", 
                type: "Donghua", 
                views: 150, 
                posterUrl: "https://placehold.co/300x450/4a148c/ffffff?text=DONGHUA+13", 
                synopsis: "Seorang pemuda yang diremehkan menemukan warisan kuno dan memulai jalan untuk mendominasi dunia kultivasi.", 
                monetizationLink: "https://adsterra.com/direct-link-13", // INI UNTUK OVERLAY (IKLAN)
                downloadLink: "https://drive.google.com/unduhan/donghua13", // INI UNTUK TOMBOL UNDUH (FILM ASLI)
                defaultEmbedUrl: "https://www.youtube.com/embed/ep13_1?autoplay=0&controls=1", 
                totalEpisodes: 40, 
                episodes: [
                    { num: 1, embedUrl: "https://www.youtube.com/embed/ep13_1?autoplay=1&controls=1" }, 
                    { num: 2, embedUrl: "https://www.youtube.com/embed/ep13_2?autoplay=1&controls=1" }, 
                    { num: 3, embedUrl: "https://www.youtube.com/embed/ep13_3?autoplay=1&controls=1" },
                    { num: 4, embedUrl: "https://www.youtube.com/embed/ep13_4?autoplay=1&controls=1" },
                    { num: 5, embedUrl: "https://www.youtube.com/embed/ep13_5?autoplay=1&controls=1" },
                    { num: 6, embedUrl: "https://www.youtube.com/embed/ep13_6?autoplay=1&controls=1" }
                ],
            },
            { 
                id: 14, 
                title: "Anime Petualangan", 
                category: "Petualangan", 
                rating: "7.5", 
                type: "Anime", 
                views: 100, 
                posterUrl: "https://placehold.co/300x450/ff5722/ffffff?text=ANIME+14", 
                synopsis: "Sekelompok bajak laut memulai perjalanan mencari harta karun terbesar di dunia.", 
                monetizationLink: "https://adsterra.com/direct-link-14", // INI UNTUK OVERLAY (IKLAN)
                downloadLink: "https://drive.google.com/unduhan/anime14", // INI UNTUK TOMBOL UNDUH (FILM ASLI)
                defaultEmbedUrl: "https://www.youtube.com/embed/ep14_1?autoplay=0&controls=1", 
                totalEpisodes: 50, 
                episodes: [
                    { num: 1, embedUrl: "https://www.youtube.com/embed/ep14_1?autoplay=1&controls=1" },
                    { num: 2, embedUrl: "https://www.youtube.com/embed/ep14_2?autoplay=1&controls=1" },
                    { num: 3, embedUrl: "https://www.youtube.com/embed/ep14_3?autoplay=1&controls=1" },
                    { num: 4, embedUrl: "https://www.youtube.com/embed/ep14_4?autoplay=1&controls=1" },
                    { num: 5, embedUrl: "https://www.youtube.com/embed/ep14_5?autoplay=1&controls=1" },
                    { num: 6, embedUrl: "https://www.youtube.com/embed/ep14_6?autoplay=1&controls=1" },
                ],
            },
            { 
                id: 15, 
                title: "Film Baru Fantasi", 
                category: "Fantasi", 
                rating: "9.0", 
                type: "Movie", 
                views: 50, 
                posterUrl: "https://placehold.co/300x450/795548/ffffff?text=MOVIE+15", 
                synopsis: "Petualangan fantasi epik dengan makhluk-makhluk ajaib dan dunia yang luas.", 
                monetizationLink: "https://adsterra.com/direct-link-15", // INI UNTUK OVERLAY (IKLAN)
                downloadLink: "https://drive.google.com/unduhan/film15", // INI UNTUK TOMBOL UNDUH (FILM ASLI)
                embedCode: "GANTI_DENGAN_URL_EMBED_YOUTUBE_ATAU_PLATFORM_LAIN?autoplay=0&controls=1",
            }
        ];

        // --- Tambahkan properti SLUG ke setiap film saat inisialisasi ---
        mockMovies.forEach(movie => {
            movie.slug = slugify(movie.title);
        });
        // -----------------------------------------------------------------

        let currentPage = 'home';
        const mainContent = document.getElementById('main-content');
        
        let currentFilterType = 'All'; 
        
        const POSTERS_PER_BATCH = 10; 
        
        let paginationState = {
            popular: 1,
            latest: 1
        };

        // [BARU] State untuk pagination daftar episode di halaman postingan
        let episodePaginationState = {}; 
        const EPISODES_PER_BATCH_LIST = 5; 


        /**
         * Menangani klik pada lapisan transparan (overlay) di atas pemutar video.
         * @param {string} directLinkUrl - URL tujuan direct link (monetization).
         * @param {string} overlayId - ID overlay yang akan dihapus.
         */
        function handleMonetizationClick(directLinkUrl, overlayId) {
            // 1. Buka direct link (Monetisasi) di tab baru
            window.open(directLinkUrl, '_blank');

            // 2. Hapus overlay
            const overlayElement = document.getElementById(overlayId);
            if (overlayElement) {
                // Hapus elemen dari DOM agar tidak mengganggu interaksi video
                overlayElement.remove(); 
                
                // Optional: Tampilkan pesan ke user
                const messageArea = document.getElementById('episode-message');
                if (messageArea) {
                    messageArea.textContent = 'Iklan telah dibuka di tab baru. Silakan klik tombol play di video.';
                    messageArea.classList.remove('text-green-600');
                    messageArea.classList.add('text-red-500', 'font-bold');
                }
            }
        }


        /**
         * Mengganti URL embed video di frame utama saat tombol episode diklik.
         */
        function changeEpisode(embedUrl, episodeIndex, movieTitle, episodeNum) {
            const videoFrame = document.getElementById('video-frame');
            const episodeMessage = document.getElementById('episode-message');
            const episodeTitleDisplay = document.getElementById('episode-title-display');
            const prevButton = document.getElementById('prev-episode-btn');
            const nextButton = document.getElementById('next-episode-btn');
            // Ambil ID film/series dari data attribute di iframe
            const movieId = parseInt(videoFrame.dataset.movieId); 
            const movie = mockMovies.find(m => m.id === movieId);


            if (videoFrame && movie) {
                // 1. Update iframe
                videoFrame.src = embedUrl; 
                videoFrame.dataset.currentEpisodeIndex = episodeIndex; // Simpan index baru

                // 2. Update UI Teks
                if (episodeTitleDisplay) {
                    episodeTitleDisplay.textContent = `${movieTitle} - Episode ${episodeNum}`;
                }
                if (episodeMessage) {
                    episodeMessage.textContent = `Episode ${episodeNum} sedang dimuat...`;
                    episodeMessage.classList.add('text-green-600');
                    episodeMessage.classList.remove('text-red-500', 'font-bold');
                    setTimeout(() => {
                        episodeMessage.textContent = '';
                    }, 2000);
                }

                // 3. Update Tombol Navigasi (Aktif/Nonaktif) - Hanya untuk Series
                const totalEpisodes = movie.episodes ? movie.episodes.length : 0;
                const isLatestEpisode = episodeIndex === totalEpisodes - 1;
                const isFirstEpisode = episodeIndex === 0;

                if (prevButton) {
                    prevButton.disabled = isFirstEpisode;
                    prevButton.classList.toggle('bg-gray-400', isFirstEpisode);
                    prevButton.classList.toggle('bg-blue-600', !isFirstEpisode);
                    prevButton.classList.toggle('hover:bg-blue-700', !isFirstEpisode);
                }
                if (nextButton) {
                    nextButton.disabled = isLatestEpisode;
                    nextButton.classList.toggle('bg-gray-400', isLatestEpisode);
                    // Tombol 'Selanjutnya' tetap merah untuk menarik perhatian
                    nextButton.classList.toggle('bg-red-600', !isLatestEpisode); 
                    nextButton.classList.toggle('hover:bg-red-700', !isLatestEpisode);
                }
                
                // 4. Update status tombol di daftar episode
                document.querySelectorAll('.episode-btn').forEach(btn => {
                    const btnIndex = parseInt(btn.dataset.episodeIndex);
                    if (btnIndex === episodeIndex) {
                        btn.classList.remove('bg-blue-100', 'text-blue-800', 'hover:bg-blue-600', 'hover:text-white');
                        btn.classList.add('bg-blue-600', 'text-white', 'ring-2', 'ring-blue-800');
                    } else {
                        btn.classList.remove('bg-blue-600', 'text-white', 'ring-2', 'ring-blue-800');
                        btn.classList.add('bg-blue-100', 'text-blue-800', 'hover:bg-blue-600', 'hover:text-white');
                    }
                });
            }
        }
        
        /**
         * Fungsi untuk navigasi Episode (Selanjutnya/Kembali)
         */
        function navigateEpisode(movieId, direction) {
            const movie = mockMovies.find(m => m.id === movieId);
            const videoFrame = document.getElementById('video-frame');
            
            if (!movie || !movie.episodes || !videoFrame) return;

            let currentIndex = parseInt(videoFrame.dataset.currentEpisodeIndex);
            let newIndex = currentIndex + direction;

            if (newIndex >= 0 && newIndex < movie.episodes.length) {
                const newEpisode = movie.episodes[newIndex];
                // Panggil changeEpisode dengan data baru
                changeEpisode(newEpisode.embedUrl, newIndex, movie.title, newEpisode.num);
                
                // [BARU] Periksa apakah episode baru berada di luar halaman tombol episode yang sedang ditampilkan
                const currentEpisodePage = episodePaginationState[movieId] || 1;
                const newEpisodePage = Math.ceil((newIndex + 1) / EPISODES_PER_BATCH_LIST);
                
                if (newEpisodePage !== currentEpisodePage) {
                    // Jika di luar halaman, pindahkan halaman dan render ulang tombol
                    episodePaginationState[movieId] = newEpisodePage;
                    const episodeListArea = document.getElementById('episode-list-area');
                    if (episodeListArea) {
                         episodeListArea.innerHTML = renderEpisodeButtons(movie);
                    }
                }
            }
        }

        /**
         * Mengganti halaman tombol episode yang ditampilkan di daftar episode bawah.
         */
        function changeEpisodePage(movieId, direction) {
            const movie = mockMovies.find(m => m.id === movieId);
            if (!movie || !movie.episodes) return;

            let currentPage = episodePaginationState[movieId] || 1;
            const totalPages = Math.ceil(movie.episodes.length / EPISODES_PER_BATCH_LIST);
            
            const newPage = currentPage + direction;

            if (newPage >= 1 && newPage <= totalPages) {
                episodePaginationState[movieId] = newPage;
                
                // Re-render hanya bagian tombol episode
                const episodeListArea = document.getElementById('episode-list-area'); 
                if (episodeListArea) {
                     // Panggil renderEpisodeButtons untuk mendapatkan HTML baru dan menggantikan yang lama
                     episodeListArea.innerHTML = renderEpisodeButtons(movie);
                }
            }
        }


        /**
         * Mendapatkan daftar film yang sudah difilter berdasarkan tipe saat ini.
         */
        function getFilteredMovies() {
            if (currentFilterType === 'All') {
                return mockMovies;
            }
            return mockMovies.filter(movie => movie.type === currentFilterType);
        }

        /**
         * Membuat HTML untuk satu bagian poster (dengan implementasi pagination).
         */
        function createPosterSection(title, movies, sectionId) {
            const currentPage = paginationState[sectionId];
            const totalPages = Math.ceil(movies.length / POSTERS_PER_BATCH);

            if (movies.length === 0) {
                 return `
                    <section id="${sectionId}" class="section-movie mt-8">
                        <h2 class="text-3xl font-bold text-gray-800 mb-6 border-b-4 border-blue-500 pb-2">${title}</h2>
                        <div class="text-center p-10 bg-white rounded-xl shadow-lg">
                            <p class="text-xl text-gray-600">Maaf, tidak ada konten ${currentFilterType} yang ditemukan di bagian ini.</p>
                        </div>
                    </section>
                `;
            }

            const startIndex = (currentPage - 1) * POSTERS_PER_BATCH;
            const endIndex = startIndex + POSTERS_PER_BATCH;
            
            let moviesToShow = movies.slice(startIndex, endIndex);
            
            if (moviesToShow.length === 0 && currentPage > 1) {
                paginationState[sectionId] = totalPages; 
                moviesToShow = movies.slice((totalPages - 1) * POSTERS_PER_BATCH, totalPages * POSTERS_PER_BATCH);
            }

            const postersHtml = moviesToShow.map(movie => {
                const isSeriesType = ['Series', 'Donghua', 'Anime'].includes(movie.type);
                const episodeLabel = (isSeriesType && movie.totalEpisodes) ? `
                    <!-- Indikator Jumlah Episode (Pojok Kanan Atas) -->
                    <div class="absolute top-2 right-2 bg-red-600 text-white text-xs font-bold px-2 py-1 rounded-lg shadow-md z-10">
                        ${movie.totalEpisodes} EPS
                    </div>
                ` : '';
                
                return `
                    <!-- Kontainer Poster -->
                    <div class="bg-white rounded-xl shadow-xl overflow-hidden transform hover:scale-[1.03] transition duration-300 cursor-pointer relative" onclick="navigate('post', '${movie.slug}')">
                        
                        <div class="relative">
                            <img src="${movie.posterUrl}" alt="Poster ${movie.title}" onerror="this.onerror=null;this.src='https://placehold.co/300x450/424242/ffffff?text=No+Image';" class="w-full h-auto object-cover">
                            
                            <!-- RATING - Pojok Kanan Atas (geser ke kiri jika ada label EPS) -->
                            <div class="absolute top-2 ${isSeriesType && movie.totalEpisodes ? 'left-2' : 'right-2'} bg-yellow-500 text-gray-900 text-sm font-bold px-2 py-1 rounded-full shadow-md z-10">
                                ⭐ ${movie.rating}
                            </div>

                            ${episodeLabel}
    
                            <!-- TYPE (Movie/Series/Donghua/Anime) - Pojok Kanan Bawah Image -->
                            <div class="absolute bottom-2 right-2 bg-blue-600 text-white text-xs font-semibold px-2 py-1 rounded-lg shadow-lg uppercase z-10">
                                ${movie.type}
                            </div>
                        </div>
    
                        <div class="p-3 text-center">
                            <h3 class="font-semibold text-lg truncate">${movie.title}</h3>
                            <p class="text-sm text-gray-500">${movie.category}</p>
                        </div>
                    </div>
                `;
            }).join('');

            const navButtons = totalPages > 1 ? `
                <div class="text-center mt-8 mb-4 flex justify-center items-center space-x-4">
                    <button 
                        onclick="changePage('${sectionId}', ${currentPage - 1})" 
                        ${currentPage <= 1 ? 'disabled' : ''}
                        class="px-6 py-3 text-white font-bold rounded-lg transition duration-300 shadow-xl 
                            ${currentPage <= 1 ? 'bg-gray-400 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-700 transform hover:scale-[1.05]'} "
                    >
                        &lt; Kembali
                    </button>
                    
                    <span class="text-lg font-semibold text-gray-700">
                        Halaman ${currentPage} dari ${totalPages}
                    </span>

                    <button 
                        onclick="changePage('${sectionId}', ${currentPage + 1})" 
                        ${currentPage >= totalPages ? 'disabled' : ''}
                        class="px-6 py-3 text-white font-bold rounded-lg transition duration-300 shadow-xl 
                            ${currentPage >= totalPages ? 'bg-gray-400 cursor-not-allowed' : 'bg-red-600 hover:bg-red-700 transform hover:scale-[1.05]'} "
                    >
                        Selanjutnya &gt;
                    </button>
                </div>
            ` : '';

            return `
                <section id="${sectionId}" class="section-movie mt-8"> 
                    <h2 class="text-3xl font-bold text-gray-800 mb-6 border-b-4 border-blue-500 pb-2">${title}</h2>
                    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
                        ${postersHtml}
                    </div>
                    ${navButtons}
                </section>
            `;
        }

        /**
         * Mengganti halaman dan memuat film untuk bagian tertentu.
         */
        function changePage(sectionId, newPage) {
            const allMovies = sectionId === 'popular' 
                ? [...getFilteredMovies()].sort((a, b) => b.views - a.views)
                : [...getFilteredMovies()].sort((a, b) => b.id - a.id); 
                
            const totalPages = Math.ceil(allMovies.length / POSTERS_PER_BATCH);

            if (newPage >= 1 && newPage <= totalPages) {
                paginationState[sectionId] = newPage;
                
                const sectionElement = document.getElementById(sectionId);
                if (sectionElement) {
                    const typeDisplay = currentFilterType === 'All' ? 'Konten' : currentFilterType;
                    const title = sectionId === 'popular' ? `${typeDisplay} Populer` : `${typeDisplay} Terbaru`;
                    sectionElement.outerHTML = createPosterSection(title, allMovies, sectionId);
                }
                window.scrollTo(0, sectionElement.offsetTop - 100); 
            }
        }

        /**
         * Memfilter tampilan berdasarkan tipe konten.
         */
        function filterType(type) {
            currentFilterType = type;
            paginationState = { popular: 1, latest: 1 };

            renderHome();
            
            const buttons = document.querySelectorAll('.category-btn');
            buttons.forEach(btn => {
                if (btn.dataset.type === type) {
                    btn.classList.remove('bg-blue-900', 'hover:bg-blue-600');
                    btn.classList.add('bg-blue-500', 'ring-2', 'ring-blue-200');
                } else {
                    btn.classList.remove('bg-blue-500', 'ring-2', 'ring-blue-200');
                    btn.classList.add('bg-blue-900', 'hover:bg-blue-600');
                }
            });
        }


        /**
         * Fungsi Pencarian Film
         */
        function searchMovies() {
            const query = document.getElementById('search-input').value.toLowerCase();
            
            if (query.trim() === '') {
                navigate('home');
                return;
            }

            const searchResults = mockMovies.filter(movie => 
                movie.title.toLowerCase().includes(query) || 
                movie.category.toLowerCase().includes(query) ||
                movie.type.toLowerCase().includes(query) 
            );

            let contentHtml = '';
            
            if (searchResults.length > 0) {
                const postersHtml = searchResults.map(movie => {
                    const isSeriesType = ['Series', 'Donghua', 'Anime'].includes(movie.type);
                    const episodeLabel = (isSeriesType && movie.totalEpisodes) ? `
                        <div class="absolute top-2 right-2 bg-red-600 text-white text-xs font-bold px-2 py-1 rounded-lg shadow-md z-10">
                            ${movie.totalEpisodes} EPS
                        </div>
                    ` : '';

                    return `
                        <div class="bg-white rounded-xl shadow-xl overflow-hidden transform hover:scale-[1.03] transition duration-300 cursor-pointer relative" onclick="navigate('post', '${movie.slug}')">
                            <div class="relative">
                                <img src="${movie.posterUrl}" alt="Poster ${movie.title}" onerror="this.onerror=null;this.src='https://placehold.co/300x450/424242/ffffff?text=No+Image';" class="w-full h-auto object-cover">
                                <div class="absolute top-2 ${isSeriesType && movie.totalEpisodes ? 'left-2' : 'right-2'} bg-yellow-500 text-gray-900 text-sm font-bold px-2 py-1 rounded-full shadow-md z-10">
                                    ⭐ ${movie.rating}
                                </div>
                                ${episodeLabel}
                                <div class="absolute bottom-2 right-2 bg-blue-600 text-white text-xs font-semibold px-2 py-1 rounded-lg shadow-lg uppercase z-10">
                                    ${movie.type}
                                </div>
                            </div>
                            <div class="p-3 text-center">
                                <h3 class="font-semibold text-lg truncate">${movie.title}</h3>
                                <p class="text-sm text-gray-500">${movie.category}</p>
                            </div>
                        </div>
                    `;
                }).join(''); 

                contentHtml = `
                    <h2 class="text-3xl font-bold text-gray-800 mb-6 border-b-4 border-blue-500 pb-2">Hasil Pencarian untuk: "${query}"</h2>
                    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
                        ${postersHtml}
                    </div>
                `;

            } else {
                contentHtml = `
                    <h2 class="text-3xl font-bold text-gray-800 mb-6 border-b-4 border-blue-500 pb-2">Hasil Pencarian untuk: "${query}"</h2>
                    <div class="text-center p-10 bg-white rounded-xl shadow-lg">
                        <p class="text-xl text-gray-600">Maaf, tidak ada film, series, donghua, atau anime yang ditemukan dengan kata kunci tersebut.</p>
                        <button onclick="navigate('home')" class="mt-4 px-4 py-2 text-white font-semibold rounded-lg bg-blue-600 hover:bg-blue-700 transition duration-300 shadow-md">
                            Kembali ke Beranda
                        </button>
                    </div>
                `;
            }

            mainContent.innerHTML = contentHtml;
            window.scrollTo(0, 0); 
        }


        // --- Halaman Beranda (Homepage) ---
        function renderHome() {
            const filteredMovies = getFilteredMovies();
            const typeDisplay = currentFilterType === 'All' ? 'Konten' : currentFilterType;

            const popularMovies = [...filteredMovies].sort((a, b) => b.views - a.views);
            const popularSectionHtml = createPosterSection(
                `${typeDisplay} Populer`, 
                popularMovies, 
                'popular'
            );

            const latestMovies = [...filteredMovies].sort((a, b) => b.id - a.id);
            const latestSectionHtml = createPosterSection(
                `${typeDisplay} Terbaru`, 
                latestMovies, 
                'latest'
            );
            
            mainContent.innerHTML = 
                popularSectionHtml +  
                latestSectionHtml;   
        }
        
        /**
         * Merender bagian rekomendasi film.
         */
        function renderRecommendations(currentMovie) {
            
            const recommendations = mockMovies.filter(movie => {
                if (movie.id === currentMovie.id) return false; 
                return movie.type === currentMovie.type; 
            }).slice(0, 5); 
            
            if (recommendations.length === 0) {
                return '';
            }

            const recommendationTitle = `${currentMovie.type} Serupa`;
            const movieTypeDisplay = currentMovie.type; 
            
            const postersHtml = recommendations.map(movie => {
                const isSeriesType = ['Series', 'Donghua', 'Anime'].includes(movie.type);
                const episodeLabel = (isSeriesType && movie.totalEpisodes) ? `
                    <div class="absolute top-2 right-2 bg-red-600 text-white text-xs font-bold px-1 py-0.5 rounded-lg shadow-md z-10">
                        ${movie.totalEpisodes} EPS
                    </div>
                ` : '';
                
                return `
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden transform hover:scale-[1.03] transition duration-300 cursor-pointer relative" onclick="navigate('post', '${movie.slug}')">
                        <div class="relative">
                            <img src="${movie.posterUrl}" alt="Poster ${movie.title}" onerror="this.onerror=null;this.src='https://placehold.co/300x450/424242/ffffff?text=No+Image';" class="w-full h-auto object-cover">
                            <div class="absolute top-2 ${isSeriesType && movie.totalEpisodes ? 'left-2' : 'right-2'} bg-yellow-500 text-gray-900 text-xs font-bold px-1 py-0.5 rounded-full shadow-md z-10">
                                ⭐ ${movie.rating}
                            </div>
                            ${episodeLabel}
                        </div>
                        <div class="p-2 text-center">
                            <h4 class="font-semibold text-sm truncate">${movie.title}</h4>
                            <p class="text-xs text-gray-500">${movie.type}</p>
                        </div>
                    </div>
                `;
            }).join('');

            return `
                <section class="mt-10 pt-4 border-t border-gray-200">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">${recommendationTitle}</h3>
                    <p class="text-sm text-gray-500 mb-4">Mungkin Anda juga menyukai konten ${movieTypeDisplay} ini.</p>
                    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-4">
                        ${postersHtml}
                    </div>
                </section>
            `;
        }

        /**
         * [BARU] Merender tombol episode dengan pagination.
         * Ini adalah logika yang diterapkan ke area yang ditunjuk pengguna.
         */
        function renderEpisodeButtons(movie) {
            if (movie.type === 'Movie' || !movie.episodes || movie.episodes.length === 0) {
                // Kembalikan div kosong atau pesan jika bukan konten ber-episode
                return `<div id="episode-list-area"></div>`;
            }
            
            // Dapatkan status halaman saat ini (default ke 1)
            const movieId = movie.id;
            const currentPage = episodePaginationState[movieId] || 1;
            const totalEpisodes = movie.episodes.length;
            const totalPages = Math.ceil(totalEpisodes / EPISODES_PER_BATCH_LIST);
            
            // Hitung indeks episode yang akan ditampilkan
            const startIndex = (currentPage - 1) * EPISODES_PER_BATCH_LIST;
            const endIndex = startIndex + EPISODES_PER_BATCH_LIST;
            const displayedEpisodes = movie.episodes.slice(startIndex, endIndex);

            // Dapatkan index episode yang sedang dimainkan dari iframe
            const videoFrame = document.getElementById('video-frame');
            let currentEpisodeIndex = -1;
            if (videoFrame) {
                currentEpisodeIndex = parseInt(videoFrame.dataset.currentEpisodeIndex);
            }
            
            const buttonsHtml = displayedEpisodes.map((ep, index) => {
                // Indeks asli di array episode
                const trueIndex = startIndex + index; 
                
                return `
                    <!-- Tombol Episode - Memanggil fungsi changeEpisode() dengan URL embed dan index episode -->
                    <button 
                       data-episode-index="${trueIndex}"
                       onclick="changeEpisode('${ep.embedUrl}', ${trueIndex}, '${movie.title}', ${ep.num})" 
                       class="episode-btn px-4 py-2 text-sm font-semibold rounded-lg transition duration-200 shadow-md flex-shrink-0
                            ${trueIndex === currentEpisodeIndex ? 'bg-blue-600 text-white ring-2 ring-blue-800' : 'bg-blue-100 text-blue-800 hover:bg-blue-600 hover:text-white'}">
                        EP ${ep.num}
                    </button>
                `;
            }).join('');

            const navButtons = totalPages > 1 ? `
                <div class="flex justify-between items-center mt-4 pt-4 border-t border-gray-100">
                    <button 
                        onclick="changeEpisodePage(${movieId}, -1)" 
                        ${currentPage <= 1 ? 'disabled' : ''}
                        class="px-4 py-2 text-sm font-bold rounded-lg transition duration-300 shadow-md 
                            ${currentPage <= 1 ? 'bg-gray-300 text-gray-600 cursor-not-allowed' : 'bg-blue-500 hover:bg-blue-600 text-white'} transform hover:scale-[1.05]"
                    >
                        &lt; Hal. Sebelumnya
                    </button>
                    <span class="text-sm text-gray-600 font-medium">
                        Hal. ${currentPage} dari ${totalPages}
                    </span>
                    <button 
                        onclick="changeEpisodePage(${movieId}, 1)" 
                        ${currentPage >= totalPages ? 'disabled' : ''}
                        class="px-4 py-2 text-sm font-bold rounded-lg transition duration-300 shadow-md 
                            ${currentPage >= totalPages ? 'bg-gray-300 text-gray-600 cursor-not-allowed' : 'bg-blue-500 hover:bg-blue-600 text-white'} transform hover:scale-[1.05]"
                    >
                        Hal. Selanjutnya &gt;
                    </button>
                </div>
            ` : '';
            
            return `
                <div>
                    <h3 class="text-xl font-semibold mb-3 text-blue-700">Pilih Episode Langsung</h3>
                    <div class="flex flex-wrap gap-3">
                        ${buttonsHtml}
                    </div>
                    ${navButtons}
                </div>
            `;
        }
        
        // --- Halaman Postingan (Post Page) ---
        function renderPost(movieSlug) {
            const movie = mockMovies.find(m => m.slug === movieSlug); 

            if (!movie) {
                mainContent.innerHTML = '<div class="text-center p-10 text-red-600">Film tidak ditemukan!</div>';
                return;
            }

            let initialEmbedUrl = movie.embedCode || placeholderEmbed;
            let initialEpisodeIndex = -1;
            let initialEpisodeNum = 0; 
            let initialTitleDisplay = movie.title; 

            const hasEpisodes = (movie.type !== 'Movie') && movie.episodes && movie.episodes.length > 0;
            
            // [BARU] Inisialisasi state pagination episode untuk film ini
            if (hasEpisodes) {
                episodePaginationState[movie.id] = 1; 
            }

            if (hasEpisodes) {
                // Muat Episode TERAKHIR (Terbaru)
                const lastEpisodeIndex = movie.episodes.length - 1; 
                const latestEpisode = movie.episodes[lastEpisodeIndex]; 
                
                initialEmbedUrl = latestEpisode.embedUrl;
                initialEpisodeIndex = lastEpisodeIndex;
                initialEpisodeNum = latestEpisode.num;
                initialTitleDisplay = `${movie.title} - Episode ${initialEpisodeNum}`;
                
                // [BARU] Sesuaikan halaman pagination episode agar menampilkan episode terakhir
                const latestEpisodePage = Math.ceil(initialEpisodeNum / EPISODES_PER_BATCH_LIST);
                episodePaginationState[movie.id] = latestEpisodePage;


            } else if (movie.type === 'Movie') {
                 initialEpisodeNum = 1;
                 initialTitleDisplay = movie.title;
            }

            const episodeNavigation = hasEpisodes ? `
                <!-- Tombol Navigasi Episode (Kembali & Selanjutnya) -->
                <div class="flex flex-col md:flex-row justify-between items-center bg-gray-100 p-4 rounded-lg shadow-inner mt-4 space-y-3 md:space-y-0">
                    
                    <!-- Tombol Kembali -->
                    <button 
                        id="prev-episode-btn"
                        onclick="navigateEpisode(${movie.id}, -1)" 
                        class="w-full md:w-auto px-5 py-2 font-bold rounded-lg transition duration-300 shadow-lg flex items-center justify-center
                            ${initialEpisodeIndex === 0 ? 'bg-gray-400 cursor-not-allowed text-gray-700' : 'bg-blue-600 hover:bg-blue-700 text-white transform hover:scale-[1.05]'}
                            disabled:opacity-50 disabled:cursor-not-allowed"
                        ${initialEpisodeIndex === 0 ? 'disabled' : ''}
                    >
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"></path></svg>
                        Kembali
                    </button>

                    <!-- Pesan Status Episode Aktif -->
                    <div class="text-center w-full md:w-auto py-2 md:py-0">
                        <p id="episode-message" class="text-sm text-green-600 font-semibold">Tonton Episode ${initialEpisodeNum}</p>
                    </div>

                    <!-- Tombol Selanjutnya -->
                    <button 
                        id="next-episode-btn"
                        onclick="navigateEpisode(${movie.id}, 1)" 
                        class="w-full md:w-auto px-5 py-2 font-bold rounded-lg transition duration-300 shadow-lg flex items-center justify-center
                            ${initialEpisodeIndex === movie.episodes.length - 1 ? 'bg-gray-400 cursor-not-allowed text-gray-700' : 'bg-red-600 hover:bg-red-700 text-white transform hover:scale-[1.05]'}
                            disabled:opacity-50 disabled:cursor-not-allowed"
                        ${initialEpisodeIndex === movie.episodes.length - 1 ? 'disabled' : ''}
                    >
                        Selanjutnya
                        <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7"></path></svg>
                    </button>
                </div>
            ` : ''; 

            const postContent = `
                <article class="bg-white p-6 rounded-xl shadow-2xl">
                    <h2 class="text-4xl font-bold text-gray-900 mb-6 border-b pb-3">${movie.title}</h2>

                    <!-- Area Poster dan Info Film -->
                    <div class="md:flex md:space-x-8 mb-8">
                        <div class="flex-shrink-0 mb-6 md:mb-0">
                            <img src="${movie.posterUrl}" alt="Poster ${movie.title}" class="w-full max-w-xs h-auto rounded-lg shadow-lg mx-auto md:mx-0">
                        </div>
                        <div class="flex-grow">
                            <h3 class="text-2xl font-semibold mb-3 text-blue-700">Sinopsis</h3>
                            <p class="text-gray-700 leading-relaxed">${movie.synopsis || 'Sinopsis tidak tersedia.'}</p>
                            <p class="mt-4 text-sm text-gray-500">
                                ID Konten: ${movie.id} | 
                                Kategori: ${movie.category} |
                                Tipe: <span class="font-bold text-red-600">${movie.type}</span> |
                                Rating: <span class="font-bold text-yellow-600">${movie.rating}</span>
                            </p>
                            ${movie.totalEpisodes ? `<p class="mt-1 text-sm text-gray-500 font-semibold">Total Episode: <span class="text-red-600">${movie.totalEpisodes}</span></p>` : ''}
                        </div>
                    </div>

                    <!-- Tempat Embed Video (Frame) & Lapisan Iklan -->
                    <div class="w-full mb-4">
                        <h3 class="text-2xl font-semibold mb-3 text-blue-700">Tonton</h3> 
                        
                        <!-- Judul Episode di ATAS Video -->
                        ${hasEpisodes ? `
                            <div class="bg-gray-200 p-3 rounded-t-lg text-center shadow-md -mb-1 z-10 relative">
                                <h4 id="episode-title-display" class="font-bold text-xl text-gray-900">
                                    ${initialTitleDisplay}
                                </h4>
                            </div>
                        ` : ''}

                        <div class="iframe-container ${hasEpisodes ? 'rounded-t-none' : ''}">
                            
                            <!-- Lapisan Transparan Penuh (Overlay Iklan) -->
                            <div id="overlay-${movie.id}" 
                                onclick="handleMonetizationClick('${movie.monetizationLink || '#'}', 'overlay-${movie.id}')"
                                class="absolute inset-0 z-20 transparent-overlay">
                            </div>
                            
                            <!-- ID 'video-frame' digunakan untuk mengganti video. Menyimpan data-attribute untuk tracking episode -->
                            <iframe id="video-frame" 
                                data-movie-id="${movie.id}"
                                data-current-episode-index="${initialEpisodeIndex}"
                                src="${initialEmbedUrl}" 
                                title="Video Player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen 
                                class="w-full h-full">
                            </iframe>
                        </div>
                    </div>

                    <!-- Area Navigasi Episode dan Catatan Autoplay -->
                    ${episodeNavigation}


                    <!-- Tombol Download dan Daftar Episode (Bawah Frame) -->
                    <div class="mt-8 mb-8 space-y-6 border-t pt-6">
                        
                        <!-- Tombol Download -->
                        <div class="border-b pb-4">
                            <h3 class="text-xl font-semibold mb-3 text-red-600">Unduh ${movie.title}</h3>
                            <a href="${movie.downloadLink || '#link-belum-tersedia'}" target="_blank" 
                               class="inline-block px-6 py-3 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700 transition duration-300 shadow-lg transform hover:scale-[1.02] 
                               ${movie.downloadLink ? '' : 'opacity-50 cursor-not-allowed'}" 
                               ${movie.downloadLink ? '' : 'onclick="event.preventDefault()"'}
                            >
                                <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                                Unduh Sekarang
                            </a>
                            ${!movie.downloadLink ? '<p class="text-sm text-gray-500 mt-2">Link unduhan belum ditambahkan.</p>' : ''}
                        </div>

                        <!-- Daftar Episode (Tombol Pilihan Langsung) -->
                        <div id="episode-list-area">
                            <!-- Konten dimuat oleh renderEpisodeButtons() -->
                        </div>
                    </div>
                    
                    <!-- Area Rekomendasi Otomatis -->
                    ${renderRecommendations(movie)}
                </article>
            `;
            
            mainContent.innerHTML = postContent;
            
            if (hasEpisodes) {
                const initialEpisode = movie.episodes[initialEpisodeIndex];
                changeEpisode(initialEpisode.embedUrl, initialEpisodeIndex, movie.title, initialEpisode.num);
                
                // [BARU] Render tombol episode untuk pertama kalinya
                const episodeListArea = document.getElementById('episode-list-area'); 
                if (episodeListArea) {
                     episodeListArea.innerHTML = renderEpisodeButtons(movie);
                }
            }
        }

        /**
         * FUNGSI BARU: Menentukan halaman mana yang harus dimuat dari URL Hash.
         */
        function handleRouting() {
            const hash = window.location.hash.substring(1); 
            
            if (hash === 'home' || hash === '') {
                navigate('home');
            } else if (hash.startsWith('post/')) {
                const movieSlug = hash.substring(5); 
                if (movieSlug.length > 0) {
                    navigate('post', movieSlug, false); 
                } else {
                    navigate('home');
                }
            } else {
                navigate('home');
            }
        }

        /**
         * Fungsi navigasi utama (Diperbarui untuk Direct Link)
         * @param {string} page - Tipe halaman ('home' atau 'post')
         * @param {string | null} identifier - SLUG film (untuk 'post') atau null (untuk 'home')
         * @param {boolean} [updateHash=true] - Apakah akan memperbarui URL hash. Default true.
         */
        function navigate(page, identifier = null, updateHash = true) {
            currentPage = page;
            
            let newHash = '';

            if (page === 'home') {
                renderHome();
                newHash = 'home';
                filterType(currentFilterType);
            } else if (page === 'post' && identifier) {
                renderPost(identifier); 
                newHash = `post/${identifier}`;
            }
            
            if (updateHash && newHash && window.location.hash !== `#${newHash}`) {
                window.location.hash = newHash; 
            }
            
            window.scrollTo(0, 0); 
        }

        // Muat halaman saat dokumen siap
        document.addEventListener('DOMContentLoaded', () => {
            // 1. Tambahkan listener untuk menangani tombol Back/Forward dan muat awal
            window.addEventListener('hashchange', handleRouting);

            // 2. Lakukan routing awal untuk memuat halaman yang sesuai dari URL 
            handleRouting(); 
        });
    </script>

</body>
</html>

